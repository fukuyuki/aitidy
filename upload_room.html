<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç´„É°„É©„Ç¢„Éó„É™</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f5;
            font-family: Arial, sans-serif;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.1);
        }

        button:active {
            transform: scale(0.95);
        }

        .icon {
            font-size: 24px;
        }

        .preview {
            position: absolute;
            top: calc(50% - 80px);
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            overflow: hidden;
            border-radius: 50%;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .preview img {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body onload="setCookie()">

    <!-- „Ç´„É°„É©„Éú„Çø„É≥ -->
    <div class="preview" id="imagePreview"></div>
    <button id="cameraButton" onclick="activateCamera()">
        <span class="icon">üì∏</span>
    </button>

    <script>
        // Cookie„Å´ UID „Çí‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞
        function setCookie() {
            const uid = "TEXT";
            document.cookie = `uid=${uid}; path=/; max-age=604800; SameSite=Lax;`;
        }

        // Cookie„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        const uid = getCookie("uid");

        // „Ç´„É°„É©Ê©üËÉΩ„ÇíËµ∑Âãï„Åô„ÇãÈñ¢Êï∞
        async function activateCamera() {
            try {
                // „Ç´„É°„É©„ÇíËµ∑Âãï„Åó„Å¶ÁîªÂÉè„ÇíÂèñÂæó
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.createElement("video");
                video.srcObject = stream;
                video.play();

                // 3ÁßíÂæå„Å´ÈùôÊ≠¢Áîª„Çí„Ç≠„É£„Éó„ÉÅ„É£„Åó„Å¶„Ç´„É°„É©„ÇíÂÅúÊ≠¢
                setTimeout(() => {
                    const canvas = document.createElement("canvas");
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    const ctx = canvas.getContext("2d");
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                    // ÁîªÂÉè„ÇíÂèñÂæó
                    const imageData = canvas.toDataURL("image/png");

                    // „Éó„É¨„Éì„É•„ÉºÈ†òÂüü„Å´Ë°®Á§∫
                    const preview = document.getElementById("imagePreview");
                    const img = document.createElement("img");
                    img.src = imageData;
                    preview.innerHTML = ""; // Êó¢Â≠ò„ÅÆÁîªÂÉè„Çí„ÇØ„É™„Ç¢
                    preview.appendChild(img);
                    preview.style.display = "block";

                    // „Ç´„É°„É©„ÇíÂÅúÊ≠¢
                    stream.getTracks().forEach(track => track.stop());

                    // Fetch API„ÅßÁîªÂÉè„ÇíÈÄÅ‰ø°
                    fetch("https://example.com/upload", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            uid: uid,
                            image: imageData
                        })
                    })
                    .then(res => res.json())
                    .then(data => console.log(data)) // „Çµ„Éº„Éê„Éº„É¨„Çπ„Éù„É≥„Çπ„ÇíË°®Á§∫
                    .catch(err => console.error("Error:", err));
                }, 3000);
            } catch (error) {
                console.error("„Ç´„É°„É©„ÅÆËµ∑Âãï„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", error);
            }
        }
    </script>
</body>
</html>
